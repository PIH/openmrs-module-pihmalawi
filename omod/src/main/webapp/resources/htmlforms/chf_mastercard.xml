<htmlform formName="Cardiac and Vascular Disease eMastercard" formUuid="40c59f30-794e-11e8-adc0-fa7ae01bbebc"
          formEncounterType="cb337ef3-f5cb-4e10-af8d-8d717a3a139f" formVersion="1.0">

    <macros>
        <macro key="yesAnswer" value="65576354-977f-11e1-8993-905e29aff6c1" />
        <macro key="noAnswer" value="6557646c-977f-11e1-8993-905e29aff6c1" />
        <macro key="unknown" value="65576584-977f-11e1-8993-905e29aff6c1" />
        <macro key="diagnosisSet" value="6db168f1-0f38-42d9-9f0e-90946a3d8e72" />
        <macro key="chronicCareDiagnosis" value="65671c9a-977f-11e1-8993-905e29aff6c1" />
        <macro key="diagnosisDate" value="65732bf2-977f-11e1-8993-905e29aff6c1" />
        <macro key="hivStatus" value="6567ae62-977f-11e1-8993-905e29aff6c1" />
        <macro key="reactive" value="65587802-977f-11e1-8993-905e29aff6c1" />
        <macro key="nonReactive" value="6558791a-977f-11e1-8993-905e29aff6c1" />
        <macro key="hivTestDate" value="655bc9da-977f-11e1-8993-905e29aff6c1" />
        <macro key="artStartDate" value="655f9eb6-977f-11e1-8993-905e29aff6c1" />
        <macro key="tbStatus" value="65770db2-977f-11e1-8993-905e29aff6c1" />
        <macro key="smearPos" value="655ddc20-977f-11e1-8993-905e29aff6c1" />
        <macro key="smearNeg" value="655ddd24-977f-11e1-8993-905e29aff6c1" />
        <macro key="eptb" value="655a49ac-977f-11e1-8993-905e29aff6c1" />
        <macro key="tbYear" value="3237c2a0-ada3-11e5-bf7f-feff819cdc9f" />
        <macro key="patientPhone" value="6559ba14-977f-11e1-8993-905e29aff6c1" />
        <macro key="guardianName" value="655bbc74-977f-11e1-8993-905e29aff6c1" />
        <macro key="guardianPhone" value="65600cd4-977f-11e1-8993-905e29aff6c1" />
        <macro key="relationToPatient" value="6558fd0e-977f-11e1-8993-905e29aff6c1" />
        <macro key="agreesToFollowup" value="655fc526-977f-11e1-8993-905e29aff6c1" />
        <macro key="chwName" value="941bc17e-8c33-11e5-80a3-c0430f805837" />
        <macro key="chfDiagnosis" value="6567bb82-977f-11e1-8993-905e29aff6c1" />
        <macro key="hypertensionDx" value="654abfc8-977f-11e1-8993-905e29aff6c1" />
        <macro key="ckdDX" value="6577c7a2-977f-11e1-8993-905e29aff6c1" />
        <macro key="familyPlanning" value="6547ac8e-977f-11e1-8993-905e29aff6c1" />
        <macro key="ecgSet" value="656598f2-977f-11e1-8993-905e29aff6c1" />
        <macro key="ecgResult" value="656597e4-977f-11e1-8993-905e29aff6c1" />
        <macro key="echoSet" value="6563e3ea-977f-11e1-8993-905e29aff6c1" />
        <macro key="echoResult" value="6567b970-977f-11e1-8993-905e29aff6c1" />
        <macro key="echoImagingResult" value="1995a751-6f80-49f5-bc89-5cc6ae767eff" />
        <macro key="echoEcgDate" value="6563e098-977f-11e1-8993-905e29aff6c1" />
        <macro key="dilatedCCF" value="65703154-977f-11e1-8993-905e29aff6c1" />
        <macro key="restrictiveCCF" value="57476df7-e885-4444-b151-152cfcdac05b" />
        <macro key="valvularCCF" value="6578972c-977f-11e1-8993-905e29aff6c1" />
        <macro key="rheumaticCCF" value="6546dad4-977f-11e1-8993-905e29aff6c1" />
        <macro key="congenitalCCF" value="6562dcd4-977f-11e1-8993-905e29aff6c1" />
        <macro key="cadCCF" value="86c2fd36-e7f1-11e8-9f32-f2801f1b9fd1" />
        <macro key="peCCF" value="657179a6-977f-11e1-8993-905e29aff6c1" />
        <macro key="strokeCCF" value="65714e68-977f-11e1-8993-905e29aff6c1" />
        <macro key="afibCCF" value="65680bfa-977f-11e1-8993-905e29aff6c1" />
        <macro key="dvtCCF" value="65717898-977f-11e1-8993-905e29aff6c1" />
        <macro key="otherCCF" value="65780d0c-977f-11e1-8993-905e29aff6c1" />
        <macro key="comorbidity" value="655a8d90-977f-11e1-8993-905e29aff6c1" />
        <macro key="hypertension" value="654abfc8-977f-11e1-8993-905e29aff6c1" />
        <macro key="diabetes" value="6567426a-977f-11e1-8993-905e29aff6c1" />
        <macro key="ckd" value="6577c7a2-977f-11e1-8993-905e29aff6c1" />
        <macro key="otherComorbidity" value="65780d0c-977f-11e1-8993-905e29aff6c1" />
    </macros>

    <span style="display:none">
        <encounterProvider default="16576" /><!-- Set provider to a default as not used -->
        <span id="patientBirthdate"><lookup expression="patient.birthdate"/></span>
    </span>
    <div>
        <h4 style="font-style: italic;">
            <b>NCD Patient Card</b>
            <b style="padding-left:50px;">Cardiac and Vascular Disease</b>
            <span style="padding-left:50px;">Version 1</span>

            <span style="padding-left:50px;">
                <b style="padding-right:10px;">
                    <encounterLocation id="mastercardLocation" />
                    <span style="padding-left:20px;">
                        Date: <encounterDate />
                    </span>
                </b>
            </span>

            <span style="padding-left:50px;">
                <b style="padding-right:10px;">NCD Reg no: </b>
                <b>
                    <lookup complexExpression="#foreach( $id in $patientIdentifiers.get(&quot;Chronic Care Number&quot;) ) $!id #end" />
                </b>
            </span>
        </h4>
        <table class="data-entry-table">
            <tr style="border: none;">
                <td style="vertical-align:top;">
                    <h5>Patient / Guardian Details</h5>
                    <table>
                        <tr>
                            <td>Patient Name</td>
                            <td>
                                <lookup expression="patient.personName" />
                            </td>
                        </tr>
                        <tr>
                            <td>Sex, DOB</td>
                            <td>
                                <span class="left-cell">
                                    <lookup expression="patient.gender" />
                                </span>
                                <span class="right-cell">
                                    <lookup expression="patient.birthdate" />
                                    (Age: <lookup expression="patient.age"/>)
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td>Physical Address</td>
                            <td><!-- style="height:60px;"-->
                                <lookup complexExpression="#foreach( $addr in $patient.addresses) $!addr.getAddress1() $!addr.getCityVillage() $!addr.getStateProvince() $!addr.getCountyDistrict(), #end" />
                            </td>
                        </tr>
                        <tr>
                            <td>Patient Phone</td>
                            <td><obs conceptId="$patientPhone" size="10"/></td>
                        </tr>
                        <tr>
                            <td>Guardian Name</td>
                            <td>
                                <obs id="guardianNameField" conceptId="$guardianName" size="40"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Guardian Phone</td>
                            <td>
                                <obs conceptId="$guardianPhone" size="10"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Guardian relation to patient</td>
                            <td>
                                <obs conceptId="$relationToPatient" size="10" />
                            </td>
                        </tr>
                        <tr>
                            <td>Agrees to FUP</td>
                            <td>
                                <obs conceptId="$agreesToFollowup" style="radio" answerLabels="N,Y" answerConceptIds="$noAnswer,$yesAnswer" />
                            </td>
                        </tr>
                        <tr>
                            <td>CHW Name</td>
                            <td>
                              <lookup complexExpression="#foreach(${relationship} in ${relationshipList})
                                  #if(${relationship.relationshipType.uuid} == 'eb567be2-fda1-4746-9d51-833de8a7e81f')
                                        ${relationship.personA.personName}
                                  #end
                              #end "/>
                            </td>
                        </tr>
                    </table>
                </td>
                <td style="vertical-align:top;">
                    <h5>Patient Overview</h5>
                    <table>
                        <tr>
                            <th style="vertical-align:top;" align="left" rowspan="6">Diagnoses</th>
                            <!--  -->
                            <obsgroup groupingConceptId="$diagnosisSet">
                                <td data-toggle-source="dilated-dx" data-toggle-target="dilated-dx-date">
                                    <obs id="dilated-dx" conceptId="$chronicCareDiagnosis" style="checkbox"
                                         answerConceptId="$dilatedCCF" answerLabel="Dilated" />
                                </td>
                                <td class="toggle-target">
                                    <obs id="dilated-dx-date" conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>

                            <obsgroup groupingConceptId="$diagnosisSet">
                                <td data-toggle-source="cad-dx" data-toggle-target="cad-dx-date" rowspan="2">
                                    <obs id="cad-dx" conceptId="$chronicCareDiagnosis" style="checkbox"
                                         answerConceptId="$cadCCF" answerLabel="CAD" />
                                </td>
                                <td class="toggle-target" rowspan="2">
                                    <obs id="cad-dx-date" conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>

                            <obsgroup groupingConceptId="$diagnosisSet">
                                <td data-toggle-source="pe-dx" data-toggle-target="pe-dx-date" rowspan="2">
                                    <obs id="pe-dx" conceptId="$chronicCareDiagnosis" style="checkbox"
                                         answerConceptId="$peCCF" answerLabel="PE" />
                                </td>
                                <td class="toggle-target" rowspan="2">
                                    <obs id="pe-dx-date" conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>
                        </tr>
                        <tr>
                            <!-- Restrictive -->
                            <obsgroup groupingConceptId="$diagnosisSet">
                                <td data-toggle-source="restrict-dx" data-toggle-target="restrict-dx-date">
                                    <obs id="restrict-dx" conceptId="$chronicCareDiagnosis" style="checkbox"
                                         answerConceptId="$restrictiveCCF" answerLabel="Restrictive" />
                                </td>
                                <td class="toggle-target">
                                    <obs id="restrict-dx-date" conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>
                        </tr>
                        <tr>
                            <!-- Valvular -->
                            <obsgroup groupingConceptId="$diagnosisSet">
                                <td data-toggle-source="valvular-dx" data-toggle-target="valvular-dx-date">
                                    <obs id="valvular-dx" conceptId="$chronicCareDiagnosis" style="checkbox"
                                         answerConceptId="$valvularCCF" answerLabel="Valvular" />
                                </td>
                                <td class="toggle-target">
                                    <obs id="valvular-dx-date" conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>
                            <obsgroup groupingConceptId="$diagnosisSet">
                                <td data-toggle-source="stroke-dx" data-toggle-target="stroke-dx-date" rowspan="2">
                                    <obs id="stroke-dx" conceptId="$chronicCareDiagnosis" style="checkbox"
                                         answerConceptId="$strokeCCF" answerLabel="Stroke" />
                                </td>
                                <td class="toggle-target" rowspan="2">
                                    <obs id="stroke-dx-date" conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>
                            <obsgroup groupingConceptId="$diagnosisSet">
                                <td data-toggle-source="dvt-dx" data-toggle-target="dvt-dx-date" rowspan="2">
                                    <obs id="dvt-dx" conceptId="$chronicCareDiagnosis" style="checkbox"
                                         answerConceptId="$dvtCCF" answerLabel="DVT" />
                                </td>
                                <td class="toggle-target" rowspan="2">
                                    <obs id="dvt-dx-date" conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>
                        </tr>
                        <tr>
                            <!-- Unknown -->
                            <obsgroup groupingConceptId="$diagnosisSet">
                                <td data-toggle-source="unknown-dx" data-toggle-target="unknown-dx-date">
                                    <obs id="unknown-dx" conceptId="$chronicCareDiagnosis" style="checkbox"
                                         answerConceptId="$unknown" answerLabel="Unknown" />
                                </td>
                                <td class="toggle-target">
                                    <obs id="unknown-dx-date" conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>
                        </tr>

                        <tr>
                            <!-- Rheumatic -->
                            <obsgroup groupingConceptId="$diagnosisSet">
                                <td data-toggle-source="rheumatic-dx" data-toggle-target="rheumatic-dx-date">
                                    <obs id="rheumatic-dx" conceptId="$chronicCareDiagnosis" style="checkbox"
                                         answerConceptId="$rheumaticCCF" answerLabel="Rheumatic" />
                                </td>
                                <td class="toggle-target">
                                    <obs id="rheumatic-dx-date" conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>
                            <obsgroup groupingConceptId="$diagnosisSet">
                                <td data-toggle-source="afib-dx" data-toggle-target="afib-dx-date" rowspan="2">
                                    <obs id="afib-dx" conceptId="$chronicCareDiagnosis" style="checkbox"
                                         answerConceptId="$afibCCF" answerLabel="Afib" />
                                </td>
                                <td class="toggle-target" rowspan="2">
                                    <obs id="afib-dx-date" conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>
                            <obsgroup groupingConceptId="$diagnosisSet">
                                <td data-toggle-source="dvt-dx" data-toggle-target="dvt-dx-date" rowspan="2">
                                    <obs id="dvt-dx" conceptId="$otherCCF" labelText="Other" />
                                </td>
                                <td class="toggle-target" rowspan="2">
                                    <obs id="dvt-dx-date" conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>
                        </tr>
                        <tr>
                            <!-- Congenital -->
                            <obsgroup groupingConceptId="$diagnosisSet">
                                <td data-toggle-source="congenital-dx" data-toggle-target="congenital-dx-date">
                                    <obs id="congenital-dx" conceptId="$chronicCareDiagnosis" style="checkbox"
                                         answerConceptId="$congenitalCCF" answerLabel="Congenital" />
                                </td>
                                <td class="toggle-target">
                                    <obs id="congenital-dx-date" conceptId="$diagnosisDate" labelText="Date"/>
                                </td>
                            </obsgroup>
                        </tr>

                        <tr>
                            <th style="vertical-align:top;" align="left">Patient<br/>History &#38;<br/>Exposures</th>
                            <td><obs conceptId="$hivStatus" labelText="HIV" answerConceptIds="$reactive,$nonReactive"/>
                                <br/>
                                <obs conceptId="$hivTestDate" labelText="Date Test"/></td>
                            <td><obs conceptId="$artStartDate" labelText="ART Start Date" /></td>
                            <td class="nowrap">
                                <obs conceptId="$tbStatus" labelText="TB" answerConceptIds="$smearPos,$smearNeg,$eptb,$unknown"
                                     answerLabels="smear pos,smear neg,EPTB,never had TB"/></td>
                            <td class="nowrap">
                                <obs conceptId="$tbYear" labelText="Year"/>
                            </td>
                            <!-- Comorbidities -->
                            <th style="vertical-align:top;">Comorbidities</th>
                            <td>
                                <obs conceptId="$comorbidity" answerConceptId="$hypertension" style = "checkbox"/><br />
                                <obs conceptId="$comorbidity" answerConceptId="$diabetes" style = "checkbox"/><br />
                                <obs conceptId="$comorbidity" answerConceptId="$ckd" style = "checkbox"/><br />
                                <obs conceptId="$otherComorbidity" labelText="Other: " /><br />
                            </td>
                        </tr>

                        <tr>
                            <th style="vertical-align:top;" align="left">Outcome</th>
                            <td colspan="6">
                                <b>
                                    <lookup expression="fn.currentProgramWorkflowStatus(16).state.concept.name" />
                                    (<lookup expression="fn.currentProgramWorkflowStatus(16).startDate" />)
                                </b>
                            </td>
                        </tr>
                    </table>

                    <h5>Imaging Results</h5>

                    <table>
                    	<tr>
                    		<th align="left">ECHO</th>
                    		<obsgroup groupingConceptId="$echoSet">
                                <td>
                                    <obs conceptId="$echoEcgDate" labelText="Date"/>
                                </td>
                                <td>
                                    <obs conceptId="$echoImagingResult" labelText="Result"/>
                                </td>
                            </obsgroup>
                    	</tr>
                    	<tr>
                    		<th align="left">ECG</th>
                    		<obsgroup groupingConceptId="$ecgSet">
                                <td>
                                    <obs conceptId="$echoEcgDate" labelText="Date"/>
                                </td>
                                <td>
                                    <obs conceptId="$ecgResult" labelText="Result"/>
                                </td>
                            </obsgroup>
                    	</tr>
                    </table>
                </td>
            </tr>
        </table>

        <ifMode mode="VIEW" include="false">
            <div id="buttons" style="margin-top:10px;">
                <button class="submitButton confirm" onclick="submitHtmlForm()">
                    <uimessage code="uicommons.save"/>
                    <i class="icon-spinner icon-spin icon-2x" style="display: none; margin-left: 10px;"></i>
                </button>
            </div>
        </ifMode>
    </div>
</htmlform>
