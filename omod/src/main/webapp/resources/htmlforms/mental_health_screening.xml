<htmlform formName="Mental Health Screening"
          formUuid="8bb404f3-f224-40dd-b0c4-76e1b8a119e4"
          formEncounterType="1ec34eeb-0776-4f58-871e-fe0026fda111"
          formVersion="1.0">

    <macros>
        nextAppt=5096
        <macro key="diagnosis" value="656292d8-977f-11e1-8993-905e29aff6c1"/>
        <macro key="referralSet" value="a4dfe545-8a85-41ca-ac47-b372b681391f" />
        <macro key="depression" value="6546cbd4-977f-11e1-8993-905e29aff6c1"/>
        <macro key="stress" value="160196AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/>
        <macro key="anxiety" value="6560bf08-977f-11e1-8993-905e29aff6c1"/>
        <macro key="anger" value="7e8abbdc-cf5c-11e5-ab30-625662870761"/>
        <macro key="griefLoss" value="657117fe-977f-11e1-8993-905e29aff6c1"/>
        <macro key="substanceDrug" value="655fbcca-977f-11e1-8993-905e29aff6c1"/>
        <macro key="other" value="8797110a-d38e-427f-a08f-260300c8c896"/>

        <macro key="intervention" value="6559e0fc-977f-11e1-8993-905e29aff6c1"/>
        <macro key="sourceOfRefSet" value="b5346c8a-246c-46aa-bce5-17a77534bc30"/>
        <macro key="pmPlus" value="656f937a-977f-11e1-8993-905e29aff6c1"/>
        <macro key="pfa" value="159238AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/>
        <macro key="psychEducation" value="383900ef-2863-4d95-a08a-3bf699586a56"/>
        <macro key="SupportiveCounselling" value="65768586-977f-11e1-8993-905e29aff6c1"/>
        <macro key="CognitiveBehavioral" value="118905AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/>
        <macro key="itrpersonalTherapy" value="47729d48-1ab6-4c27-86fe-4700d734909d"/>
        <macro key="CaseManagement" value="6577051a-977f-11e1-8993-905e29aff6c1"/>
        <macro key="referral" value="da88696b-bf1d-4a31-b49d-997326e4a777"/>
        <macro key="noneCodedText" value="d57e3a20-5802-11e6-8b77-86f30ca893d3" />

        <macro key="sssNumber" value="06b1f7d8-b6cc-11e8-96f8-529269fb1459"/>
        <macro key="one" value="697e9461-f2d6-4ab1-a140-48f768ce002a"/>
        <macro key="two" value="11c0f708-6950-4e94-b080-5c76174a4947"/>
        <macro key="three" value="224e3d57-f6d1-4244-bbe2-b81a574ba7aa"/>

        <macro key="sessionNotes" value="65600176-977f-11e1-8993-905e29aff6c1"/>
        <macro key="outcome" value="655ab086-977f-11e1-8993-905e29aff6c1"/>
        <macro key="discharged" value="6566dba4-977f-11e1-8993-905e29aff6c1"/>
        <macro key="missedAppointment" value="655d345a-977f-11e1-8993-905e29aff6c1"/>
        <macro key="defaulter" value="65736928-977f-11e1-8993-905e29aff6c1"/>
        <macro key="relocation" value="9f262c0e-e850-11e8-9f32-f2801f1b9fd1"/>
        <macro key="died" value="655b5e46-977f-11e1-8993-905e29aff6c1"/>
        <macro key="stopped" value="655a6acc-977f-11e1-8993-905e29aff6c1"/>


        <macro key="otDate" value="655ff92e-977f-11e1-8993-905e29aff6c1"/> <!-- outcome date -->
        <macro key="comments" value="655928e2-977f-11e1-8993-905e29aff6c1"/>

        <macro key="nenoLocations" expression="fn.globalProperty('pihmalawi.systemLocationsTag')"/>
    </macros>

    <style>

        .nowrap {
        white-space: nowrap;
        }
    </style>

    <!-- Flowsheet table view -->
    <ifMode mode="VIEW" include="true">

        <table class="visit-table data-entry-table">
            <thead class="visit-table-header">
                <tr>
                    <td style="padding: 1px;">Visit Date</td>
                    <td rowspan="2" >Diagnosis</td>
                    <td rowspan="2">Intervention</td>
                    <td rowspan="2">Sessions</td>
                    <td rowspan="2">Session Notes</td>
                    <td rowspan="2">Outcome</td>
                    <td rowspan="2">Outcome Date</td>
                    <td rowspan="2">Comments</td>
                    <td rowspan="2">Next Appointment Date</td>
                </tr>

            </thead>
            <tbody class="visit-table-body">
                <tr class="visit-table-row">
                    <td class="nowrap visit-date">
                        <encounterDate/>
                    </td>

                    <!-- Diagnosis -->
                    <td>
                            <obs conceptId="$diagnosis" style="checkbox" answerConceptId="$depression" answerLabel="Depression" />
                            <obs conceptId="$diagnosis" style="checkbox" answerConceptId="$stress" answerLabel="Stress" />
                            <obs conceptId="$diagnosis" style="checkbox" answerConceptId="$anxiety" answerLabel="Anxiety" />
                            <obs conceptId="$diagnosis" style="checkbox" answerConceptId="$anger" answerLabel="Anger" />
                            <obs conceptId="$diagnosis" style="checkbox" answerConceptId="$griefLoss" answerLabel="Grief and loss" />
                            <obs conceptId="$diagnosis" style="checkbox" answerConceptId="$substanceDrug" answerLabel="Substance and Drug" />

                        <obsgroup groupingConceptId="$referralSet">
                            <obs conceptId="$diagnosis" style="checkbox" answerConceptId="$other" answerLabel="Oth" />
                            <br />
                            <br />
                            <b>Specify:</b><obs conceptId="$noneCodedText" style="textarea" cols="60"/>
                        </obsgroup>

                    </td>

                    <!-- Intervention -->
                    <td>
                        <obs conceptId="$intervention" style="checkbox" answerConceptId="$pmPlus" answerLabel="PM +" />
                        <obs conceptId="$intervention" style="checkbox" answerConceptId="$pfa" answerLabel="PFA" />
                        <obs conceptId="$intervention" style="checkbox" answerConceptId="$psychEducation" answerLabel="psych education" />
                        <obs conceptId="$intervention" style="checkbox" answerConceptId="$SupportiveCounselling" answerLabel="Supportive counselling" />
                        <obs conceptId="$intervention" style="checkbox" answerConceptId="$CognitiveBehavioral" answerLabel="Cognitive behavioral therapy" />
                        <obs conceptId="$intervention" style="checkbox" answerConceptId="$itrpersonalTherapy" answerLabel="Interpersonal therapy" />
                        <obs conceptId="$intervention" style="checkbox" answerConceptId="$CaseManagement" answerLabel="Case management" />

                        <obsgroup groupingConceptId="$sourceOfRefSet">
                            <obs conceptId="$intervention" style="checkbox" answerConceptId="$other" answerLabel="Other" />
                            <br />
                            <br />
                            <b>Specify:</b><obs conceptId="$noneCodedText" style="textarea" cols="60"/>
                        </obsgroup>
                    </td>


                    <!-- Sessions -->
                    <td style="padding: 1px;">
                        <obs conceptId="$sssNumber"
                             answerConceptIds="$one,$two,$three"
                             answerLabels="Session 1,Session 2,Session 3" style="radio" />
                    </td>

                    <!-- Session Notes -->
                    <td style="padding: 1px;">
                        <obs conceptId="$sessionNotes" />
                    </td>


                    <!-- Outcomes -->
                    <td style="padding: 1px;">
                        <obs conceptId="$outcome"
                             answerConceptIds="$discharged,$missedAppointment,$defaulter,$relocation,$died,$stopped"
                             answerLabels="Discharged,Missed appointment,Defaulter,Relocation,Died,Stopped" style="radio" />
                    </td>

                    <!-- Outcome date -->
                    <td style="padding: 1px;">
                        <obs conceptId="$otDate" />
                    </td>

                    <!-- Comments -->
                    <td style="padding: 1px;">
                        <obs conceptId="$comments" />
                    </td>

                    <td style="padding: 1px;" >
                        <!-- Next appointment -->
                        <obs conceptId="$nextAppt" id="appointmentDate" allowFutureDates="true" allowOverride="true"/>
                    </td>


                </tr>
            </tbody>
        </table>
    </ifMode>

    <!-- Data entry view -->
    <ifMode mode="VIEW" include="false">

        <h4 style="font-style: italic;">
            <b>Mental Health Screening Form</b>
            <span style="padding-left:50px;">Version 1</span>
            <span id="patientUuid" style="display:none"><lookup expression="patient.uuid"/></span>
            <span style="padding-left:50px;">
                <b style="padding-right:10px;">NCD Reg no: </b>
                <b>
                    <lookup complexExpression="#foreach( $id in $patientIdentifiers.get(&quot;Chronic Care Number&quot;) ) $!id #end" />
                </b>
            </span>
        </h4>

        <span style="display:none"><encounterProvider default="16576" /></span> <!-- Set provider to a default as not used -->

        <table class="visit-edit-table">

            <tr>
                <th>Visit Date</th>
                <td><lookup complexExpression="#if($encounter) $ui.format($encounter.encounterDatetime) #else $ui.format($context.defaultEncounterDate) #end" />
                    <span id="visitDateError" class="error field-error" style="display:none;color: rgb(255, 0, 0);"></span>
                    <span style="display:none"><encounterDate id="visitDate" size="20" /></span>
                </td>
            </tr>
            <tr>
                <th>Visit Location</th>
                <td><encounterLocation id="visitLocation" tags="$nenoLocations" /></td>
            </tr>

            <tr>
                <th>Diagnosis</th>
                <td>
                    <obs conceptId="$diagnosis" style="checkbox" answerConceptId="$depression" answerLabel="Depression" />
                    <obs conceptId="$diagnosis" style="checkbox" answerConceptId="$stress" answerLabel="Stress" />
                    <obs conceptId="$diagnosis" style="checkbox" answerConceptId="$anxiety" answerLabel="Anxiety" />
                    <obs conceptId="$diagnosis" style="checkbox" answerConceptId="$anger" answerLabel="Anger" />
                    <obs conceptId="$diagnosis" style="checkbox" answerConceptId="$griefLoss" answerLabel="Grief and loss" />
                    <obs conceptId="$diagnosis" style="checkbox" answerConceptId="$substanceDrug" answerLabel="Substance and Drug" />

                    <obsgroup groupingConceptId="$referralSet">
                        <obs conceptId="$diagnosis" style="checkbox" answerConceptId="$other" answerLabel="Other" />
                        <br />
                        <br />
                        <b>Specify:</b><obs conceptId="$noneCodedText" style="textarea" cols="30"/>
                    </obsgroup>

                </td>
            </tr>

            <tr>
                <th>Intervention</th>
                <td>
                    <obs conceptId="$intervention" style="checkbox" answerConceptId="$pmPlus" answerLabel="PM +" />
                    <obs conceptId="$intervention" style="checkbox" answerConceptId="$pfa" answerLabel="PFA" />
                    <obs conceptId="$intervention" style="checkbox" answerConceptId="$psychEducation" answerLabel="psych education" />
                    <obs conceptId="$intervention" style="checkbox" answerConceptId="$SupportiveCounselling" answerLabel="Supportive counselling" />
                    <obs conceptId="$intervention" style="checkbox" answerConceptId="$CognitiveBehavioral" answerLabel="Cognitive behavioral therapy" />
                    <obs conceptId="$intervention" style="checkbox" answerConceptId="$itrpersonalTherapy" answerLabel="Interpersonal therapy" />
                    <obs conceptId="$intervention" style="checkbox" answerConceptId="$CaseManagement" answerLabel="Case management" />

                    <obsgroup groupingConceptId="$sourceOfRefSet">
                        <obs conceptId="$intervention" style="checkbox" answerConceptId="$other" answerLabel="Other" />
                        <br />
                        <br />
                        <b>Specify:</b><obs conceptId="$noneCodedText" style="textarea" cols="60"/>
                    </obsgroup>
                </td>
            </tr>

            <tr>
                <th>Sessions</th>
                <td style="padding: 1px;">
                    <obs conceptId="$sssNumber"
                         answerConceptIds="$one,$two,$three"
                         answerLabels="Session 1,Session 2,Session 3" style="radio" />
                </td>
            </tr>

            <tr>
                <th>Session Notes</th>
                <td style="padding: 1px;">
                    <obs conceptId="$sessionNotes" />
                </td>
            </tr>

            <tr>
                <th>Outcomes</th>
                <td style="padding: 1px;">
                    <obs conceptId="$outcome"
                         answerConceptIds="$discharged,$missedAppointment,$defaulter,$relocation,$died,$stopped"
                         answerLabels="Discharged,Missed appointment,Defaulter,Relocation,Died,Stopped" style="radio" />
                </td>
            </tr>

            <tr>
                <th>Outcome date</th>
                <td style="padding: 1px;">
                    <obs conceptId="$otDate" />
                </td>
            </tr>

            <tr>
                <th>Comments</th>
                <td style="padding: 1px;">
                    <obs conceptId="$comments" />
                </td>
            </tr>

            <tr>
                <th>Next Appointment</th>
                <td style="padding: 1px;" >
                    <obs conceptId="$nextAppt" id="appointmentDate" allowFutureDates="true" allowOverride="true"/>
                </td>
            </tr>

        </table>
        <submit />
    </ifMode>

</htmlform>
