<htmlform formName="Sickle Cell Disease Visit"
          formUuid="E68275D4-C300-46B0-8754-4C2CF2598B78"
          formEncounterType="D4073EB7-60B1-4586-B062-13FCE4CBC9E8"
          formVersion="1.0">

    <macros>
        <macro key="noAnswer" value="6557646c-977f-11e1-8993-905e29aff6c1" />
        <macro key="yesAnswer" value="65576354-977f-11e1-8993-905e29aff6c1" />
        <!--Vital Sgns and Labs-->
        <macro key="height" value="6569c562-977f-11e1-8993-905e29aff6c1" />
        <macro key="weight" value="6569c44a-977f-11e1-8993-905e29aff6c1" />
        <macro key="wtChange" value="1be55e42-9a11-11e8-9eb6-529269fb1459" />
        <macro key="systolicBP" value="6569bffe-977f-11e1-8993-905e29aff6c1" />
        <macro key="diastolicBP" value="6569c116-977f-11e1-8993-905e29aff6c1" />
        <macro key="heartRate" value="6569c224-977f-11e1-8993-905e29aff6c1" />
        <macro key="Creatinine" value="657170a0-977f-11e1-8993-905e29aff6c1" />
        <macro key="urineProtein" value="65717366-977f-11e1-8993-905e29aff6c1" />
        <macro key="noUrineProtein" value="654994c2-977f-11e1-8993-905e29aff6c1" />
        <macro key="trace" value="6572cf72-977f-11e1-8993-905e29aff6c1" />
        <macro key="weaklyPos" value="65598fb2-977f-11e1-8993-905e29aff6c1" />
        <macro key="moderatelyPos" value="65597cde-977f-11e1-8993-905e29aff6c1" />
        <macro key="stronglyPos" value="65598706-977f-11e1-8993-905e29aff6c1" />
        <!--Signs and Symptoms-->
        <macro key="confusion" value="657592c0-977f-11e1-8993-905e29aff6c1" />
        <macro key="patientHasFatigue" value="71195f66-a9c7-4c33-b6be-90ef9ff9535f" />
        <macro key="patientHasNausea" value="104cb8fb-8ff9-4ea4-b547-10fed3afdea2" />
        <macro key="patientHasAnorexia" value="ac7a7aae-6f3a-4a04-a147-97019597886f" />
        <macro key="patientHasPruritus" value="ca2cd277-cdfc-42b0-9958-3f1281480ad8" />
        <macro key="patientHasAscites" value="2b0f959a-8877-434b-8cc4-430682e7c9f4" />
        <macro key="symptomsOther" value="654b3fac-977f-11e1-8993-905e29aff6c1" />

        <macro key="tookMedicToday" value="5f91e983-f825-4f41-81de-077288a5d860" />

        <macro key="hospitalized" value="655b3dc6-977f-11e1-8993-905e29aff6c1"/>
        <macro key="pain" value="e26e1f17-0bf5-4600-801c-16e23180d60e"/>
        <macro key="fever" value="65637fa4-977f-11e1-8993-905e29aff6c1"/>
        <macro key="schoolAbsence" value="656cb22c-977f-11e1-8993-905e29aff6c1"/>
        <macro key="malaria" value="65461b8a-977f-11e1-8993-905e29aff6c1"/>
        <macro key="antibiotics" value="6575888e-977f-11e1-8993-905e29aff6c1"/>
        <macro key="spleenEnlargement" value="e384a58c-4a73-11ec-81d3-0242ac130003"/>
        <macro key="medicationSideEffect" value="d046e48d-7eda-4a6f-b583-c13281d9640e"/>
        <macro key="jaundice" value="6557aea4-977f-11e1-8993-905e29aff6c1"/>
        <macro key="pinkConjunctiva" value="6570e5b8-977f-11e1-8993-905e29aff6c1"/>
        <macro key="clearLungs" value="65639304-977f-11e1-8993-905e29aff6c1"/>
        <macro key="ascites" value="6548e7fc-977f-11e1-8993-905e29aff6c1"/>
        <macro key="enlargedLiver" value="5c05bcc5-a25e-4e36-98ef-579060c4c460"/>
        <macro key="bmi" value="655d615a-977f-11e1-8993-905e29aff6c1"/>
        <macro key="bloodOxygen" value="6569c792-977f-11e1-8993-905e29aff6c1"/>
        <macro key="temperature" value="6569c33c-977f-11e1-8993-905e29aff6c1"/>
        <macro key="folicAcid" value="6547162a-977f-11e1-8993-905e29aff6c1"/>
        <!--Benzathine penicillin-->
        <macro key="bzn" value="656930ac-977f-11e1-8993-905e29aff6c1"/>
        <!-- Malaria prophylaxis: Sulfalene and pyramethamine -->
        <macro key="sulfalene" value="65478970-977f-11e1-8993-905e29aff6c1" />
        <macro key="hydroxyurea" value="e1742ab7-b110-4378-8718-50933c4cfd7c"/>
        <macro key="medicationOther" value="c8a4d207-0a73-4471-955c-c1f47cbbe2b5" />


        <macro key="conjunctiva" value="6560c728-977f-11e1-8993-905e29aff6c1" />
        <macro key="paleConjunctiva" value="6548a256-977f-11e1-8993-905e29aff6c1" />
        <macro key="edema" value="bd057502-c23b-4f80-b24c-b996e8a84dfc" />
        <macro key="ckdStage" value="fd79ad7e-53ea-461a-b075-27beee44a6cc" />
        <macro key="OneTwoCKDStage" value="d45b3164-bdb1-4411-9f22-d998c9af116c" />
        <macro key="threeCKDStage" value="358c0e8f-708a-48f3-ba2c-e7fe16a24cfd" />
        <macro key="fourFiveCKDStage" value="d0a884e6-8bb5-451c-a321-f63242d216b7" />
        <macro key="nsaidUse" value="89a3d604-43f9-4d4e-95ad-8b8577f80108" />
        <macro key="glomerularFRate" value="a0d7e2b0-d69c-11e8-9f8b-f2801f1b9fd1" />
        <macro key="tobacco" value="655a4dc6-977f-11e1-8993-905e29aff6c1" />
        <macro key="alcohol" value="655a4ed4-977f-11e1-8993-905e29aff6c1" />
        <macro key="current" value="655a4cc2-977f-11e1-8993-905e29aff6c1" />
        <macro key="never" value="65577f4c-977f-11e1-8993-905e29aff6c1" />
        <macro key="stopped" value="655a4ab0-977f-11e1-8993-905e29aff6c1" />
        <macro key="none" value="6557987e-977f-11e1-8993-905e29aff6c1" />
        <macro key="drugSet" value="447aaa7a-cd03-11e5-9956-625662870761" />
        <macro key="drugsNow" value="65585192-977f-11e1-8993-905e29aff6c1" />
        <macro key="haemoglobin" value="657a745c-977f-11e1-8993-905e29aff6c1" />
        <!-- diuretic=8466 -->
        <macro key="hydrochlorothiazide" value="65588df6-977f-11e1-8993-905e29aff6c1" />
        <macro key="furosemide" value="6546003c-977f-11e1-8993-905e29aff6c1" />
        <macro key="spironolactone" value="65694c36-977f-11e1-8993-905e29aff6c1" />
        <!-- ccBlocker=8465 -->
        <macro key="amlodipine" value="65635ef2-977f-11e1-8993-905e29aff6c1" />
        <macro key="nifedipineModifiedRelease" value="654704dc-977f-11e1-8993-905e29aff6c1" />
        <!-- aceInhibit=8464 -->
        <macro key="enalapril" value="65588cde-977f-11e1-8993-905e29aff6c1" />
        <macro key="captopril" value="6563597a-977f-11e1-8993-905e29aff6c1" />
        <macro key="lisinopril" value="65635a74-977f-11e1-8993-905e29aff6c1" />
        <!-- betaBlocker=8463 -->
        <macro key="atenolol" value="65635d58-977f-11e1-8993-905e29aff6c1" />
        bisoprolol=8612
        <macro key="propranolol" value="65470f18-977f-11e1-8993-905e29aff6c1" />
        <macro key="dietRecommendations" value="ccc842f5-c7ee-4b82-865c-be19053c4db3" />
        <macro key="sodiumLow" value="5e7a1d78-aecc-4b47-bc81-d144dc91dda1" />
        <macro key="potassiumLow" value="0ddfbe32-04c3-4b03-a057-ca3b5524cbb5" />
        <macro key="proteinLow" value="f8770f87-1834-4331-a8f5-88df5e6f9573" />
        <macro key="caloriesHigh" value="3cfde72e-8626-4ee2-97e8-6f40172953f5" />
        <macro key="medicationOther" value="c8a4d207-0a73-4471-955c-c1f47cbbe2b5" />
        <macro key="nextAppt" value="6569cbd4-977f-11e1-8993-905e29aff6c1" />
        <macro key="nenoLocations" expression="fn.globalProperty('pihmalawi.systemLocationsTag')"/>
        <macro key="formEncTypeUuid" value="1ebe2272-974e-11e8-9eb6-529269fb1459"/>

        <macro key="dispensingConstruct" value="3269F65B-1A28-42EE-8578-B9658387AA00"/>
        <macro key="medicationName" value="65585192-977f-11e1-8993-905e29aff6c1"/>
        <macro key="qPerDose" value="160856AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/>
        <macro key="dosingUnit" value="162384AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/>
        <macro key="milliGram" value="161553AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/>
        <macro key="milliLiter" value="162263AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/>
        <macro key="capsule" value="6569265c-977f-11e1-8993-905e29aff6c1"/>
        <macro key="tablet" value="656921d4-977f-11e1-8993-905e29aff6c1"/>
        <macro key="routeOfAdmin" value="b08011b8-b1c7-4fd0-b48d-65a475397639"/>
        <macro key="oral" value="65640244-977f-11e1-8993-905e29aff6c1"/>
        <macro key="intravenous" value="65640348-977f-11e1-8993-905e29aff6c1"/>
        <macro key="drugFrequency" value="6563fb14-977f-11e1-8993-905e29aff6c1"/>
        <macro key="medicationDuration" value="159368AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/>
        <macro key="timeUnits" value="f1904502-319d-4681-9030-e642111e7ce2"/>
        <macro key="amountDispensed" value="65614392-977f-11e1-8993-905e29aff6c1"/>
        <macro key="adminInstructions" value="ef7f742b-76e6-4a83-84ca-534ad6705494"/>
    </macros>

    <ifMode mode="VIEW" include="false">

        <script type="text/javascript">

            jq(function() {

            var searchNextApptDate = function() {
            var nextAppointDateValue = jq("span#appointmentDate input[type='hidden']").val();
            if (!nextAppointDateValue) {
            // if value was not entered yet then search within other followup encounters on the same day
            var visitDateInput = jq("span#visitDate input[type='hidden']").val();
            // the Visit Date is in the format YYYY-MM-DD
            var dateParts = visitDateInput.split("-");
            // month is 0-based, that's why we need dataParts[1] - 1
            var visitDate = new Date(+dateParts[0], dateParts[1] - 1, +dateParts[2]);

            var nextAppointDate = '<lookup expression="fn.latestObs(5096).getValueDatetime()"/>';
            if (nextAppointDate) {
            var latestNextAppointDate = new Date(nextAppointDate);
            var obsDatetime = '<lookup expression="fn.latestObs(5096).getObsDatetime()"/>';
            if (obsDatetime) {
            var jsObsDatetime = new Date(obsDatetime);
            if ( visitDate.getFullYear() ===  jsObsDatetime.getFullYear() &amp;&amp;
            visitDate.getMonth() === jsObsDatetime.getMonth() &amp;&amp;
            visitDate.getDate() === jsObsDatetime.getDate() ) {
            //we found a Next Appointment Date set on the same day on a different encounter
            var appointDateWidget = getField('appointmentDate.value').datepicker('setDate', latestNextAppointDate);
            setValue('appointmentDate.value', latestNextAppointDate);
            jq("#appointmentDate").children("input[type=hidden]").first().trigger('change');
            }
            }
            }
            }
            }

            var findNextApptDate = setInterval(function() {
            searchNextApptDate();
            clearInterval(findNextApptDate);
            }, 500);
            });

        </script>
    </ifMode>

    <!-- Flowsheet table view -->
    <ifMode mode="VIEW" include="true">

        <table class="visit-table data-entry-table">
            <thead class="visit-table-header">
                <tr> <!-- Label row -->
                    <td rowspan="2">Visit Date</td>
                    <td colspan="8"><span>Vitals</span></td>
                    <td colspan="7"><span>History Since Last Visit</span></td>
                    <td colspan="6"><span>Physical Examination</span></td>
                    <td colspan="5"><span>Medications</span></td>
                    <td rowspan="2">Next Visit Date</td>
                </tr>
                <tr> <!-- Units row -->
                    <td>Ht (cm)</td>
                    <td>Wt (kg)</td>
                    <td>BMI / MUAC</td>
                    <td>Bp (mmh/g)</td>
                    <td>HR (pbm)</td>
                    <td>HB</td>
                    <td>%SPO2 </td>
                    <td>Temp</td>
                    <td class="rotate">Hospitalized since <b/> last visit?</td>
                    <td class="rotate">Absence <b/> from school</td>
                    <td class="rotate">Pain</td>
                    <td class="rotate">Fever</td>
                    <td class="rotate">Medication Rx</td>
                    <td class="rotate">Antibiotics Rx</td>
                    <td class="rotate">Medication <b/> Side Effects?</td>
                    <td>Jaundice?</td>
                    <td>Irregular Conjunctiva?</td>
                    <td>Abnormal Lungs Exam?</td>
                    <td>Ascites?</td>
                    <td>Enlarged Spleen?</td>
                    <td>Enlarged Liver?</td>
                    <td>Malaria Prophylaxis</td>
                    <td>Folic Acid</td>
                    <td>Hydroxyurea</td>
                    <td>BZN</td>
                    <td>Other</td>
                </tr>
            </thead>
            <tbody class="visit-table-body">
                <tr class="visit-table-row">
                    <td class="nowrap visit-date">
                        <encounterDate/>
                    </td>

                    <td>
                        <!-- Height -->
                        <obsreference conceptId="$height" id="heightEntered" size="3"/>
                    </td>
                    <td>
                        <!-- Weight -->
                        <obsreference conceptId="$weight" id="weightInput" size="3"/>
                    </td>

                    <td>
                        <!-- BMI-->
                        <obs conceptId="$bmi" />
                    </td>

                    <!--
                    <td>
                        weight change
                        <obs conceptId="$wtChange" />
                    </td> -->

                    <td>
                        <!-- BP -->
                        <obsreference conceptId="$systolicBP" />/<obsreference conceptId="$diastolicBP" />
                    </td>

                    <!--
                    <td>
                        Glomerular Filtration Rate
                        <obs conceptId="$glomerularFRate" />
                    </td>-->

                    <td>
                        <!-- Heart Rate -->
                        <obs conceptId="$heartRate" />
                    </td>

                    <td>
                        <!-- HB -->
                        <obs conceptId="$haemoglobin" />
                    </td>

                    <td>
                        <!-- %SPO2 -->
                        <obs conceptId="$bloodOxygen"/>
                    </td>

                    <td>
                        <!-- Temperature -->
                        <obs conceptId="$temperature"/>
                    </td>

                    <td>
                        <!-- hospitalized since last visit-->
                        <obs conceptId="$hospitalized"
                             answerConceptIds="$yesAnswer,$noAnswer"
                             answerLabels="Y,N" style="radio" />
                    </td>

                    <td>
                        <!-- Absence from school-->
                        <obs conceptId="$schoolAbsence"
                             answerConceptIds="$yesAnswer,$noAnswer"
                             answerLabels="Y,N" style="radio" />
                    </td>

                    <td>
                        <!-- Pain-->
                        <obs conceptId="$pain"
                             answerConceptIds="$yesAnswer,$noAnswer"
                             answerLabels="Y,N" style="radio" />
                    </td>

                    <td>
                        <!-- Fever-->
                        <obs conceptId="$fever"
                             answerConceptIds="$yesAnswer,$noAnswer"
                             answerLabels="Y,N" style="radio" />
                    </td>

                    <td>
                        <!-- Malaria Rx-->
                        <obs conceptId="$malaria"
                             answerConceptIds="$yesAnswer,$noAnswer"
                             answerLabels="Y,N" style="radio" />
                    </td>

                    <td>
                        <!-- Antibiotics Rx-->
                        <obs conceptId="$antibiotics"
                             answerConceptIds="$yesAnswer,$noAnswer"
                             answerLabels="Y,N" style="radio" />
                    </td>

                    <td>
                        <!-- Medication Side Effects-->
                        <obs conceptId="$medicationSideEffect"
                             answerConceptIds="$yesAnswer,$noAnswer"
                             answerLabels="Y,N" style="radio" />
                    </td>

                    <td>
                        <!-- Jaundice-->
                        <obs conceptId="$jaundice"
                             answerConceptIds="$yesAnswer,$noAnswer"
                             answerLabels="Y,N" style="radio" />
                    </td>

                    <td>
                        <!-- Irregular Conjunctiva-->
                        <obs conceptId="$pinkConjunctiva"
                             answerConceptIds="$yesAnswer,$noAnswer"
                             answerLabels="Y,N" style="radio" />
                    </td>

                    <td>
                        <!-- Abnormal Lungs Exam-->
                        <obs conceptId="$clearLungs"
                             answerConceptIds="$yesAnswer,$noAnswer"
                             answerLabels="Y,N" style="radio" />
                    </td>

                    <td>
                        <!-- Ascites-->
                        <obs conceptId="$ascites"
                             answerConceptIds="$yesAnswer,$noAnswer"
                             answerLabels="Y,N" style="radio" />
                    </td>

                    <td>
                        <!-- Enlarged Spleen-->
                        <obs conceptId="$spleenEnlargement"
                             answerConceptIds="$yesAnswer,$noAnswer"
                             answerLabels="Y,N" style="radio" />
                    </td>

                    <td>
                        <!-- Enlarged Liver-->
                        <obs conceptId="$enlargedLiver"
                             answerConceptIds="$yesAnswer,$noAnswer"
                             answerLabels="Y,N" style="radio" />
                    </td>

                    <td style="text-align: left;">
                        <!-- Malaria Prophylaxis -->
                            <obsgroup groupingConceptId="$dispensingConstruct" showIfEmpty="false">
                                <fieldset class="medication">
                                    <span class="nowrap">
                                        <obs class="medication-name" conceptId="$medicationName" answerConceptId="$sulfalene" answerLabel="SP" style="checkbox"/> :
                                        <obs class="doseInput" conceptId="$qPerDose"/>
                                        <obs class="doseInput select-arrow"
                                             conceptId="$dosingUnit"
                                             answerConceptIds="$milliGram,$milliLiter,$capsule,$tablet"
                                             answerCodes="mg,mL,capsule,tablet"/>
                                        <obs class="route select-arrow"
                                             conceptId="$routeOfAdmin"
                                             answerConceptIds="$oral,$intravenous"
                                             answerLabels="Oral,IV"/>
                                        <obs class="frequency select-arrow"
                                             conceptId="$drugFrequency"
                                             answerConceptIds=
                                                     "PIH Malawi:3321,PIH Malawi:3322,PIH Malawi:3323,PIH Malawi:6100,PIH Malawi:1619,PIH:PRN,PIH Malawi:6408"
                                             answerCodes="OD,BID,TID,QID,STAT,PRN,other"/>
                                        <obs class="duration doseInput" conceptId="$medicationDuration"/>
                                        <obs class="duration-unit select-arrow"
                                             conceptId="$timeUnits"
                                             answerConceptIds="PIH:Hours,PIH Malawi:1072,PIH Malawi:1073,PIH Malawi:1074"/>
                                    </span>
                                </fieldset>
                            </obsgroup>
                    </td>

                    <td style="text-align: left;">
                        <!-- Folic Acid -->
                        <obsgroup groupingConceptId="$dispensingConstruct" showIfEmpty="false">
                            <fieldset class="medication">
                                <span class="nowrap">
                                    <obs class="medication-name" conceptId="$medicationName" answerConceptId="$folicAcid" answerLabel="FCD" style="checkbox"/> :
                                    <obs class="doseInput" conceptId="$qPerDose"/>
                                    <obs class="doseInput select-arrow"
                                         conceptId="$dosingUnit"
                                         answerConceptIds="$milliGram,$milliLiter,$capsule,$tablet"
                                         answerCodes="mg,mL,capsule,tablet"/>
                                    <obs class="route select-arrow"
                                         conceptId="$routeOfAdmin"
                                         answerConceptIds="$oral,$intravenous"
                                         answerLabels="Oral,IV"/>
                                    <obs class="frequency select-arrow"
                                         conceptId="$drugFrequency"
                                         answerConceptIds=
                                                 "PIH Malawi:3321,PIH Malawi:3322,PIH Malawi:3323,PIH Malawi:6100,PIH Malawi:1619,PIH:PRN,PIH Malawi:6408"
                                         answerCodes="OD,BID,TID,QID,STAT,PRN,other"/>
                                    <obs class="duration doseInput" conceptId="$medicationDuration"/>
                                    <obs class="duration-unit select-arrow"
                                         conceptId="$timeUnits"
                                         answerConceptIds="PIH:Hours,PIH Malawi:1072,PIH Malawi:1073,PIH Malawi:1074"/>
                                </span>
                            </fieldset>
                        </obsgroup>
                    </td>

                    <td style="text-align: left;">
                        <!-- Hydroxyurea -->
                        <obsgroup groupingConceptId="$dispensingConstruct" showIfEmpty="false">
                            <fieldset class="medication">
                                <span class="nowrap">
                                    <obs class="medication-name" conceptId="$medicationName" answerConceptId="$hydroxyurea" answerLabel="HYD" style="checkbox"/> :
                                    <obs class="doseInput" conceptId="$qPerDose"/>
                                    <obs class="doseInput select-arrow"
                                         conceptId="$dosingUnit"
                                         answerConceptIds="$milliGram,$milliLiter,$capsule,$tablet"
                                         answerCodes="mg,mL,capsule,tablet"/>
                                    <obs class="route select-arrow"
                                         conceptId="$routeOfAdmin"
                                         answerConceptIds="$oral,$intravenous"
                                         answerLabels="Oral,IV"/>
                                    <obs class="frequency select-arrow"
                                         conceptId="$drugFrequency"
                                         answerConceptIds=
                                                 "PIH Malawi:3321,PIH Malawi:3322,PIH Malawi:3323,PIH Malawi:6100,PIH Malawi:1619,PIH:PRN,PIH Malawi:6408"
                                         answerCodes="OD,BID,TID,QID,STAT,PRN,other"/>
                                    <obs class="duration doseInput" conceptId="$medicationDuration"/>
                                    <obs class="duration-unit select-arrow"
                                         conceptId="$timeUnits"
                                         answerConceptIds="PIH:Hours,PIH Malawi:1072,PIH Malawi:1073,PIH Malawi:1074"/>
                                </span>
                            </fieldset>
                        </obsgroup>
                    </td>

                    <td style="text-align: left;">
                        <!-- BZN  -->
                        <obsgroup groupingConceptId="$dispensingConstruct" showIfEmpty="false">
                            <fieldset class="medication">
                                <span class="nowrap">
                                    <obs class="medication-name" conceptId="$medicationName" answerConceptId="$bzn" answerLabel="BZN" style="checkbox"/> :
                                    <obs class="doseInput" conceptId="$qPerDose"/>
                                    <obs class="doseInput select-arrow"
                                         conceptId="$dosingUnit"
                                         answerConceptIds="$milliGram,$milliLiter,$capsule,$tablet"
                                         answerCodes="mg,mL,capsule,tablet"/>
                                    <obs class="route select-arrow"
                                         conceptId="$routeOfAdmin"
                                         answerConceptIds="$oral,$intravenous"
                                         answerLabels="Oral,IV"/>
                                    <obs class="frequency select-arrow"
                                         conceptId="$drugFrequency"
                                         answerConceptIds=
                                                 "PIH Malawi:3321,PIH Malawi:3322,PIH Malawi:3323,PIH Malawi:6100,PIH Malawi:1619,PIH:PRN,PIH Malawi:6408"
                                         answerCodes="OD,BID,TID,QID,STAT,PRN,other"/>
                                    <obs class="duration doseInput" conceptId="$medicationDuration"/>
                                    <obs class="duration-unit select-arrow"
                                         conceptId="$timeUnits"
                                         answerConceptIds="PIH:Hours,PIH Malawi:1072,PIH Malawi:1073,PIH Malawi:1074"/>
                                </span>
                            </fieldset>
                        </obsgroup>
                    </td>

                    <td>
                        <!-- Other medication -->
                        <obsgroup groupingConceptId="$dispensingConstruct" showIfEmpty="false">
                            <fieldset class="medication">
                                <span class="nowrap">
                                    <obs class="medication-name" conceptId="$medicationName" answerConceptId="PIH Malawi:6408" answerLabel="" style="checkbox"/>:
                                    <obs conceptId="$medicationOther" />:
                                    <obs id="dose-asp" class="doseInput" conceptId="$qPerDose"/>
                                    <obs id="asp-doseUnit" class="doseInput select-arrow"
                                         conceptId="$dosingUnit"
                                         answerConceptIds="$milliGram,$milliLiter,$capsule,$tablet"
                                         answerCodes="mg,mL,capsule,tablet"/>
                                    <obs id="route-asp" class="route select-arrow"
                                         conceptId="$routeOfAdmin"
                                         answerConceptIds="$oral,$intravenous"
                                         answerLabels="Oral,IV"/>
                                    <obs id="asp-frequencyCoded" class="frequency select-arrow"
                                         conceptId="$drugFrequency"
                                         answerConceptIds=
                                                 "PIH Malawi:3321,PIH Malawi:3322,PIH Malawi:3323,PIH Malawi:6100,PIH Malawi:1619,PIH:PRN,PIH Malawi:6408"
                                         answerCodes="OD,BID,TID,QID,STAT,PRN,other"/>
                                    <obs id="duration-asp" class="duration doseInput" conceptId="$medicationDuration"/>
                                    <obs id="durationUnit-asp" class="duration-unit select-arrow"
                                         conceptId="$timeUnits"
                                         answerConceptIds="PIH:Hours,PIH Malawi:1072,PIH Malawi:1073,PIH Malawi:1074"/>
                                </span>
                            </fieldset>
                        </obsgroup>
                    </td>

                    <td>
                        <!-- Next appointment -->
                        <obs conceptId="$nextAppt" id="appointmentDate" allowFutureDates="true" allowOverride="true"/>
                    </td>
                </tr>
            </tbody>
        </table>

    </ifMode>

    <!-- Data entry view -->
    <ifMode mode="VIEW" include="false">

        <h4 style="font-style: italic;">
            <b>Sickle Cell Disease Patient Card</b>
            <span style="padding-left:50px;">Version 1</span>
            <span id="patientUuid" style="display:none"><lookup expression="patient.uuid"/></span>
            <span style="padding-left:50px;">
                <b style="padding-right:10px;">Chronic Care no: </b>
                <b>
                    <lookup complexExpression="#foreach( $id in $patientIdentifiers.get(&quot;Chronic Care Number&quot;) ) $!id #end" />
                </b>
            </span>
        </h4>

        <span style="display:none"><encounterProvider default="16576" /></span> <!-- Set provider to a default as not used -->

        <table class="visit-edit-table">
            <tr>
                <th>Visit Date</th>
                <td><lookup complexExpression="#if($encounter) $ui.format($encounter.encounterDatetime) #else $ui.format($context.defaultEncounterDate) #end" />
                    <span id="visitDateError" class="error field-error" style="display:none;color: rgb(255, 0, 0);"></span>
                    <span style="display:none"><encounterDate id="visitDate" size="20" /></span>
                </td>
            </tr>
            <tr>
                <th>Visit Location</th>
                <td><encounterLocation id="visitLocation" tags="$nenoLocations"/></td>
            </tr>

            <tr>
                <!-- Height -->
                <th>Height</th>
                <td class="focus-field"><obsreference conceptId="$height" id="heightInput" showUnits="true"/></td>
            </tr>
            <tr>
                <!-- Weight -->
                <th>Weight</th>
                <td><obsreference conceptId="$weight" id="weightInput" showUnits="true"/></td>
            </tr>

            <!--
            <tr>
                <th>Weight change</th>
                <td><obs conceptId="$wtChange" /></td>
            </tr>-->

            <tr>
                <th> BMI/MUAC</th>
                <td>
                    <obs conceptId="$bmi" />
                </td>
            </tr>

            <tr>
                <th>Blood Pressure</th>
                <td>
                    <obsreference conceptId="$systolicBP" />/<obsreference conceptId="$diastolicBP" />
                </td>
            </tr>

            <!--
            <tr>
                <th>GFR</th>
                <td><obs conceptId="$glomerularFRate" showUnits="true" /></td>
            </tr> -->

            <tr>
                <th>Heart Rate</th>
                <td><obs conceptId="$heartRate" showUnits="true" /></td>
            </tr>

            <tr>
                <th>HB</th>
                <td>
                    <obs conceptId="$haemoglobin" showUnits="true" />
                </td>
            </tr>

            <tr>
                <th>%SPO2</th>
                <td>
                    <obs conceptId="$bloodOxygen" showUnits="true"/>
                </td>
            </tr>

            <tr>
                <th>Temperature</th>
                <td>
                    <obs conceptId="$temperature" showUnits="true"/>
                </td>
            </tr>

            <tr>
                <th>Hospitalized since last visit for SCD</th>
                <td>
                    <obs conceptId="$hospitalized"
                         answerConceptIds="$yesAnswer,$noAnswer"
                         answerLabels="Y,N" style="radio" />
                </td>
            </tr>

            <tr>
                <th>Absence from School</th>
                <td>
                    <obs conceptId="$schoolAbsence"
                         answerConceptIds="$yesAnswer,$noAnswer"
                         answerLabels="Y,N" style="radio" />
                </td>
            </tr>

            <tr>
                <th>Pain</th>
                <td>
                    <obs conceptId="$pain"
                         answerConceptIds="$yesAnswer,$noAnswer"
                         answerLabels="Y,N" style="radio" />
                </td>
            </tr>

            <tr>
                <th>Fever</th>
                <td>
                    <obs conceptId="$fever"
                         answerConceptIds="$yesAnswer,$noAnswer"
                         answerLabels="Y,N" style="radio" />
                </td>
            </tr>

            <tr>
                <th>Malaria Rx</th>
                <td>
                    <obs conceptId="$malaria"
                         answerConceptIds="$yesAnswer,$noAnswer"
                         answerLabels="Y,N" style="radio" />
                </td>
            </tr>

            <tr>
                <th>Antibiotics Rx</th>
                <td>
                    <obs conceptId="$antibiotics"
                         answerConceptIds="$yesAnswer,$noAnswer"
                         answerLabels="Y,N" style="radio" />
                </td>
            </tr>

            <tr>
                <th>Medication Side Effects?</th>
                <td>
                    <obs conceptId="$medicationSideEffect"
                         answerConceptIds="$yesAnswer,$noAnswer"
                         answerLabels="Y,N" style="radio" />
                </td>
            </tr>

            <tr>
                <th>Jaundice</th>
                <td>
                    <obs conceptId="$jaundice"
                         answerConceptIds="$yesAnswer,$noAnswer"
                         answerLabels="Y,N" style="radio" />
                </td>
            </tr>

            <tr>
                <th>Irregular Conjunctiva</th>
                <td>
                    <obs conceptId="$pinkConjunctiva"
                         answerConceptIds="$yesAnswer,$noAnswer"
                         answerLabels="Y,N" style="radio" />
                </td>
            </tr>

            <tr>
                <th>Abnormal Lungs Exam</th>
                <td>
                    <obs conceptId="$clearLungs"
                         answerConceptIds="$yesAnswer,$noAnswer"
                         answerLabels="Y,N" style="radio" />
                </td>
            </tr>

            <tr>
                <th>Ascites</th>
                <td>
                    <obs conceptId="$ascites"
                         answerConceptIds="$yesAnswer,$noAnswer"
                         answerLabels="Y,N" style="radio" />
                </td>
            </tr>

            <tr>
                <th>Enlarged Spleen</th>
                <td>
                    <obs conceptId="$spleenEnlargement"
                         answerConceptIds="$yesAnswer,$noAnswer"
                         answerLabels="Y,N" style="radio" />
                </td>
            </tr>

            <tr>
                <th>Enlarged Liver</th>
                <td>
                    <obs conceptId="$enlargedLiver"
                         answerConceptIds="$yesAnswer,$noAnswer"
                         answerLabels="Y,N" style="radio" />
                </td>
            </tr>

            <tr>
                <th>Malaria Prophylaxis</th>
                <td>
                    <table>
                        <obsgroup groupingConceptId="$dispensingConstruct" showIfEmpty="false">
                            <tr>
                                <td style="width: 20%;">
                                    <obs class="medication-name" conceptId="$medicationName" answerConceptId="$sulfalene" answerLabel="SP" style="checkbox" toggle="diab_{0}_med"/>
                                </td>
                                <td style="align: left;">
                                    <div id="diab_{0}_med" class="section-container toggle">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th colspan="2">
                                                        <uimessage code="Dose"/>
                                                    </th>
                                                    <th>
                                                        <uimessage code="Route"/>
                                                    </th>
                                                    <th>
                                                        <uimessage code="Frequency"/>
                                                    </th>
                                                    <th colspan="2">
                                                        <uimessage code="Duration"/>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr id="medication-asp" class="medication">
                                                    <td style="width: 40px;">
                                                        <obs id="dose_{0}" class="doseInput" conceptId="$qPerDose"/>
                                                    </td>
                                                    <td id="asp-rx-dose-unit" style="width: 80px;">
                                                        <obs id="doseUnit_{0}" class="doseInput select-arrow"
                                                             conceptId="$dosingUnit"
                                                             answerConceptIds="$milliGram,$milliLiter,$capsule,$tablet"
                                                             answerCodes="mg,mL,capsule,tablet"/>
                                                    </td>
                                                    <td id="asp-rx-route" style="width: 100px;">
                                                        <obs id="route_{0}" class="route select-arrow"
                                                             conceptId="$routeOfAdmin"
                                                             answerConceptIds="$oral,$intravenous"
                                                             answerLabels="Oral,IV"/>
                                                    </td>
                                                    <td id="asp-rx-frequency" style="width: 100px;">
                                                        <obs id="frequencyCoded_{0}" class="frequency select-arrow"
                                                             conceptId="$drugFrequency"
                                                             answerConceptIds=
                                                                     "PIH Malawi:3321,PIH Malawi:3322,PIH Malawi:3323,PIH Malawi:6100,PIH Malawi:1619,PIH:PRN,PIH Malawi:6408"
                                                             answerCodes="OD,BID,TID,QID,STAT,PRN,other"/>
                                                    </td>
                                                    <td id="asp-rx-duration" style="width: 60px;">
                                                        <obs id="duration_{0}" class="duration doseInput" conceptId="$medicationDuration"/>
                                                    </td>
                                                    <td id="asp-rx-duration-unit" style="width: 180px;">
                                                        <obs id="durationUnit_{0}" class="duration-unit select-arrow"
                                                             conceptId="$timeUnits"
                                                             answerConceptIds="PIH:Hours,PIH Malawi:1072,PIH Malawi:1073,PIH Malawi:1074"/>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </td>
                            </tr>
                        </obsgroup>
                    </table>
                </td>
            </tr>

            <tr>
                <th>Folic Acid</th>
                <td>
                    <table>
                        <obsgroup groupingConceptId="$dispensingConstruct" showIfEmpty="false">
                            <tr>
                                <td style="width: 20%;">
                                    <obs class="medication-name" conceptId="$medicationName" answerConceptId="$folicAcid" answerLabel="FCD" style="checkbox" toggle="diab_{0}_med"/>
                                </td>
                                <td style="align: left;">
                                    <div id="diab_{0}_med" class="section-container toggle">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th colspan="2">
                                                        <uimessage code="Dose"/>
                                                    </th>
                                                    <th>
                                                        <uimessage code="Route"/>
                                                    </th>
                                                    <th>
                                                        <uimessage code="Frequency"/>
                                                    </th>
                                                    <th colspan="2">
                                                        <uimessage code="Duration"/>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr id="medication-asp" class="medication">
                                                    <td style="width: 40px;">
                                                        <obs id="dose_{0}" class="doseInput" conceptId="$qPerDose"/>
                                                    </td>
                                                    <td id="asp-rx-dose-unit" style="width: 80px;">
                                                        <obs id="doseUnit_{0}" class="doseInput select-arrow"
                                                             conceptId="$dosingUnit"
                                                             answerConceptIds="$milliGram,$milliLiter,$capsule,$tablet"
                                                             answerCodes="mg,mL,capsule,tablet"/>
                                                    </td>
                                                    <td id="asp-rx-route" style="width: 100px;">
                                                        <obs id="route_{0}" class="route select-arrow"
                                                             conceptId="$routeOfAdmin"
                                                             answerConceptIds="$oral,$intravenous"
                                                             answerLabels="Oral,IV"/>
                                                    </td>
                                                    <td id="asp-rx-frequency" style="width: 100px;">
                                                        <obs id="frequencyCoded_{0}" class="frequency select-arrow"
                                                             conceptId="$drugFrequency"
                                                             answerConceptIds=
                                                                     "PIH Malawi:3321,PIH Malawi:3322,PIH Malawi:3323,PIH Malawi:6100,PIH Malawi:1619,PIH:PRN,PIH Malawi:6408"
                                                             answerCodes="OD,BID,TID,QID,STAT,PRN,other"/>
                                                    </td>
                                                    <td id="asp-rx-duration" style="width: 60px;">
                                                        <obs id="duration_{0}" class="duration doseInput" conceptId="$medicationDuration"/>
                                                    </td>
                                                    <td id="asp-rx-duration-unit" style="width: 180px;">
                                                        <obs id="durationUnit_{0}" class="duration-unit select-arrow"
                                                             conceptId="$timeUnits"
                                                             answerConceptIds="PIH:Hours,PIH Malawi:1072,PIH Malawi:1073,PIH Malawi:1074"/>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </td>
                            </tr>
                        </obsgroup>
                    </table>
                </td>
            </tr>

            <tr>
                <th>Hydoxyurea</th>
                <td>
                    <table>
                        <obsgroup groupingConceptId="$dispensingConstruct" showIfEmpty="false">
                            <tr>
                                <td style="width: 20%;">
                                    <obs class="medication-name" conceptId="$medicationName" answerConceptId="$hydroxyurea" answerLabel="HYD" style="checkbox" toggle="diab_{0}_med"/>
                                </td>
                                <td style="align: left;">
                                    <div id="diab_{0}_med" class="section-container toggle">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th colspan="2">
                                                        <uimessage code="Dose"/>
                                                    </th>
                                                    <th>
                                                        <uimessage code="Route"/>
                                                    </th>
                                                    <th>
                                                        <uimessage code="Frequency"/>
                                                    </th>
                                                    <th colspan="2">
                                                        <uimessage code="Duration"/>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr id="medication-asp" class="medication">
                                                    <td style="width: 40px;">
                                                        <obs id="dose_{0}" class="doseInput" conceptId="$qPerDose"/>
                                                    </td>
                                                    <td id="asp-rx-dose-unit" style="width: 80px;">
                                                        <obs id="doseUnit_{0}" class="doseInput select-arrow"
                                                             conceptId="$dosingUnit"
                                                             answerConceptIds="$milliGram,$milliLiter,$capsule,$tablet"
                                                             answerCodes="mg,mL,capsule,tablet"/>
                                                    </td>
                                                    <td id="asp-rx-route" style="width: 100px;">
                                                        <obs id="route_{0}" class="route select-arrow"
                                                             conceptId="$routeOfAdmin"
                                                             answerConceptIds="$oral,$intravenous"
                                                             answerLabels="Oral,IV"/>
                                                    </td>
                                                    <td id="asp-rx-frequency" style="width: 100px;">
                                                        <obs id="frequencyCoded_{0}" class="frequency select-arrow"
                                                             conceptId="$drugFrequency"
                                                             answerConceptIds=
                                                                     "PIH Malawi:3321,PIH Malawi:3322,PIH Malawi:3323,PIH Malawi:6100,PIH Malawi:1619,PIH:PRN,PIH Malawi:6408"
                                                             answerCodes="OD,BID,TID,QID,STAT,PRN,other"/>
                                                    </td>
                                                    <td id="asp-rx-duration" style="width: 60px;">
                                                        <obs id="duration_{0}" class="duration doseInput" conceptId="$medicationDuration"/>
                                                    </td>
                                                    <td id="asp-rx-duration-unit" style="width: 180px;">
                                                        <obs id="durationUnit_{0}" class="duration-unit select-arrow"
                                                             conceptId="$timeUnits"
                                                             answerConceptIds="PIH:Hours,PIH Malawi:1072,PIH Malawi:1073,PIH Malawi:1074"/>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </td>
                            </tr>
                        </obsgroup>
                    </table>
                </td>
            </tr>




            <tr>
                <th>BZN</th>
                <td>
                    <table>
                            <obsgroup groupingConceptId="$dispensingConstruct" showIfEmpty="false">
                                <tr>
                                    <td style="width: 20%;">
                                        <obs class="medication-name" conceptId="$medicationName" answerConceptId="$bzn" answerLabel="BZN" style="checkbox" toggle="diab_{0}_med"/>
                                    </td>
                                    <td style="align: left;">
                                        <div id="diab_{0}_med" class="section-container toggle">
                                            <table>
                                                <thead>
                                                    <tr>
                                                        <th colspan="2">
                                                            <uimessage code="Dose"/>
                                                        </th>
                                                        <th>
                                                            <uimessage code="Route"/>
                                                        </th>
                                                        <th>
                                                            <uimessage code="Frequency"/>
                                                        </th>
                                                        <th colspan="2">
                                                            <uimessage code="Duration"/>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr id="medication-asp" class="medication">
                                                        <td style="width: 40px;">
                                                            <obs id="dose_{0}" class="doseInput" conceptId="$qPerDose"/>
                                                        </td>
                                                        <td id="asp-rx-dose-unit" style="width: 80px;">
                                                            <obs id="doseUnit_{0}" class="doseInput select-arrow"
                                                                 conceptId="$dosingUnit"
                                                                 answerConceptIds="$milliGram,$milliLiter,$capsule,$tablet"
                                                                 answerCodes="mg,mL,capsule,tablet"/>
                                                        </td>
                                                        <td id="asp-rx-route" style="width: 100px;">
                                                            <obs id="route_{0}" class="route select-arrow"
                                                                 conceptId="$routeOfAdmin"
                                                                 answerConceptIds="$oral,$intravenous"
                                                                 answerLabels="Oral,IV"/>
                                                        </td>
                                                        <td id="asp-rx-frequency" style="width: 100px;">
                                                            <obs id="frequencyCoded_{0}" class="frequency select-arrow"
                                                                 conceptId="$drugFrequency"
                                                                 answerConceptIds=
                                                                         "PIH Malawi:3321,PIH Malawi:3322,PIH Malawi:3323,PIH Malawi:6100,PIH Malawi:1619,PIH:PRN,PIH Malawi:6408"
                                                                 answerCodes="OD,BID,TID,QID,STAT,PRN,other"/>
                                                        </td>
                                                        <td id="asp-rx-duration" style="width: 60px;">
                                                            <obs id="duration_{0}" class="duration doseInput" conceptId="$medicationDuration"/>
                                                        </td>
                                                        <td id="asp-rx-duration-unit" style="width: 180px;">
                                                            <obs id="durationUnit_{0}" class="duration-unit select-arrow"
                                                                 conceptId="$timeUnits"
                                                                 answerConceptIds="PIH:Hours,PIH Malawi:1072,PIH Malawi:1073,PIH Malawi:1074"/>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </td>
                                </tr>
                            </obsgroup>
                    </table>
                </td>
            </tr>


            <tr>
                <th>Other</th>
                <td>
                    <table>
                        <obsgroup groupingConceptId="$dispensingConstruct" showIfEmpty="false">
                            <td style="width: 20%;">
                                <obs class="medication-name" conceptId="$medicationName" answerConceptId="PIH Malawi:6408" answerLabel="Other, " style="checkbox" toggle="chf_noncodedText_med"/>
                                <obs conceptId="$medicationOther" labelText="please specify:"/>
                            </td>
                            <td style="align: left;">
                                <div id="chf_noncodedText_med" class="section-container toggle">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th colspan="2">
                                                    <uimessage code="Dose"/>
                                                </th>
                                                <th>
                                                    <uimessage code="Route"/>
                                                </th>
                                                <th>
                                                    <uimessage code="Frequency"/>
                                                </th>
                                                <th colspan="2">
                                                    <uimessage code="Duration"/>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr id="medication-asp" class="medication">
                                                <td style="width: 40px;">
                                                    <obs id="dose_noncodedText" class="doseInput" conceptId="$qPerDose"/>
                                                </td>
                                                <td id="asp-rx-dose-unit" style="width: 80px;">
                                                    <obs id="doseUnit_noncodedText" class="doseInput select-arrow"
                                                         conceptId="$dosingUnit"
                                                         answerConceptIds="$milliGram,$milliLiter,$capsule,$tablet"
                                                         answerCodes="mg,mL,capsule,tablet"/>
                                                </td>
                                                <td id="asp-rx-route" style="width: 100px;">
                                                    <obs id="route_noncodedText" class="route select-arrow"
                                                         conceptId="$routeOfAdmin"
                                                         answerConceptIds="$oral,$intravenous"
                                                         answerLabels="Oral,IV"/>
                                                </td>
                                                <td id="asp-rx-frequency" style="width: 100px;">
                                                    <obs id="frequencyCoded_noncodedText" class="frequency select-arrow"
                                                         conceptId="$drugFrequency"
                                                         answerConceptIds=
                                                                 "PIH Malawi:3321,PIH Malawi:3322,PIH Malawi:3323,PIH Malawi:6100,PIH Malawi:1619,PIH:PRN,PIH Malawi:6408"
                                                         answerCodes="OD,BID,TID,QID,STAT,PRN,other"/>
                                                </td>
                                                <td id="asp-rx-duration" style="width: 60px;">
                                                    <obs id="duration_noncodedText" class="duration doseInput" conceptId="$medicationDuration"/>
                                                </td>
                                                <td id="asp-rx-duration-unit" style="width: 180px;">
                                                    <obs id="durationUnit_noncodedText" class="duration-unit select-arrow"
                                                         conceptId="$timeUnits"
                                                         answerConceptIds="PIH:Hours,PIH Malawi:1072,PIH Malawi:1073,PIH Malawi:1074"/>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </td>
                        </obsgroup>
                    </table>
                </td>
            </tr>

            <tr>
                <th>Next appointment</th>
                <td><obs conceptId="$nextAppt" id="appointmentDate" allowFutureDates="true" allowOverride="true"/></td>
            </tr>

        </table>
        <submit />
    </ifMode>

</htmlform>
